@model ContractMonthlyClaimSystem.ViewModels.ManagerDashboardVM

@{
    Layout = "~/Views/Shared/ManagerLayout.cshtml";
    ViewData["Title"] = "All Submitted Claims";
}

<h2>All Submitted Claims</h2>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">@TempData["SuccessMessage"]</div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
}

<div class="mb-3 d-flex flex-wrap gap-2 align-items-center">
    <span class="badge bg-info">Verified: @Model.ComputedTotalVerified</span>
    <span class="badge bg-success">Approved: @Model.ComputedTotalApproved</span>
    <span class="badge bg-danger">Rejected: @Model.ComputedTotalRejected</span>
    <span class="badge bg-secondary">Total Claims: @Model.AllClaims.Count()</span>
</div>

<div class="row row-cols-1 row-cols-md-2 g-4">

    @foreach (var claim in Model.AllClaims)
    {
        var progressPercent = claim.Status switch
        {
            "Verified" => 66,
            "Approved" => 100,
            "Rejected" => 100,
            _ => 0
        };

        var progressColor = claim.Status switch
        {
            "Verified" => "bg-info",
            "Approved" => "bg-success",
            "Rejected" => "bg-danger",
            _ => "bg-secondary"
        };

        <div class="col">
            <div class="card mb-3 shadow-sm">

                <div class="card-header @(progressColor) text-white">
                    @claim.Title - <strong>@claim.Status</strong>
                </div>

                <div class="card-body">

                    <!-- Lecturer Info -->
                    <h6 class="card-subtitle mb-2 text-muted">Lecturer Information</h6>
                    <p>
                        <strong>Name:</strong> @claim.FullName<br />
                        <strong>Employee ID:</strong> @claim.EmployeeID<br />
                        <strong>Year Level:</strong> @claim.YearLevel<br />
                        <strong>Qualification:</strong> @claim.QualificationName (@claim.QualificationCode)<br />
                        <strong>Faculty:</strong> @claim.Faculty
                    </p>

                    <!-- Module Info -->
                    <h6 class="card-subtitle mb-2 text-muted">Module Information</h6>
                    <p>
                        <strong>Module Name:</strong> @claim.ModuleName<br />
                        <strong>Module Code:</strong> @claim.ModuleCode
                    </p>

                    <!-- Claim Details -->
                    <h6 class="card-subtitle mb-2 text-muted">Claim Details</h6>
                    <p>
                        <strong>Hours Worked:</strong> @claim.HoursWorked<br />
                        <strong>Hourly Rate:</strong> @claim.HourlyRate.ToString("C")<br />
                        <strong>Total Amount:</strong> @claim.TotalAmount.ToString("C")<br />
                        <strong>Submitted On:</strong> @claim.DateSubmitted.ToString("dd MMM yyyy")<br />
                        <strong>Supporting Document:</strong>
                        @if (!string.IsNullOrEmpty(claim.FilePath))
                        {
                            <a href="@claim.FilePath" target="_blank" class="btn btn-sm btn-info">View</a>
                        }
                        else
                        {
                            <span class="text-muted">No file</span>
                        }
                    </p>

                    <!-- Progress Bar -->
                    <div class="progress mb-2">
                        <div class="progress-bar @(progressColor)"
                             role="progressbar"
                             style="width:@progressPercent%"
                             aria-valuenow="@progressPercent"
                             aria-valuemin="0"
                             aria-valuemax="100">
                            @progressPercent%
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                @if (claim.Status == "Verified")
                {
                    <div class="card-footer text-end">
                        <a class="btn btn-success btn-sm" asp-action="Approve" asp-route-id="@claim.Id">Approve</a>
                        <a class="btn btn-danger btn-sm" asp-action="Reject" asp-route-id="@claim.Id">Reject</a>
                    </div>
                }

            </div>
        </div>
    }
</div>
